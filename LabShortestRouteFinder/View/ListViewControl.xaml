<UserControl x:Class="LabShortestRouteFinder.View.ListViewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:LabShortestRouteFinder.ViewModel">
    <Grid>
        <StackPanel Orientation="Vertical">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Margin="10" Content="Save" Width="80" Click="SaveButton_Click" />
            </StackPanel>

            <DataGrid ItemsSource="{Binding Routes}" 
                     SelectedItem="{Binding SelectedRoute}"
                     AutoGenerateColumns="False" 
                     Margin="10" 
                     IsReadOnly="False"
                     CanUserAddRows="True"
                     CanUserDeleteRows="True"
                     MaxHeight="400"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Auto">
                <DataGrid.Resources>
                    <ComboBox x:Key="citiesComboBox" 
                             ItemsSource="{Binding DataContext.Cities, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                             DisplayMemberPath="Name"/>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Start">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding DataContext.Cities, 
                                          RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          SelectedItem="{Binding Start, UpdateSourceTrigger=PropertyChanged}"
                                          DisplayMemberPath="Name"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding DataContext.Cities, 
                                          RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          SelectedItem="{Binding Start, UpdateSourceTrigger=PropertyChanged}"
                                          DisplayMemberPath="Name"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Destination">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding DataContext.Cities, 
                                          RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          SelectedItem="{Binding Destination, UpdateSourceTrigger=PropertyChanged}"
                                          DisplayMemberPath="Name"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding DataContext.Cities, 
                                          RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                          SelectedItem="{Binding Destination, UpdateSourceTrigger=PropertyChanged}"
                                          DisplayMemberPath="Name"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Distance (km)" 
                                      Binding="{Binding Distance, Mode=TwoWay}" />
                    <DataGridTextColumn Header="Cost (SEK)" 
                                      Binding="{Binding Cost, Mode=TwoWay}" />
                </DataGrid.Columns>
            </DataGrid>

            <!-- Status Message -->
            <Border Background="#FFFFFF"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Padding="8"
                    Margin="10">
                <TextBlock Text="{Binding StatusMessage}"
                           Foreground="#212121"
                           FontWeight="Bold" />
            </Border>
        </StackPanel>
    </Grid>
</UserControl>